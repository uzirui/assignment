import{_ as ee,p as le,j as R,k as te,r as u,o as ae,d as oe,c as f,f as b,m as A,a as n,e as i,b as o,t as g,w as s,h as r,i as m,F as L,g as F,n as se,v as $,x as H,u as ne}from"./index-CXkfDJvP.js";import{u as ue}from"./article-DUuUa79x.js";import{m as K,H as T}from"./atom-one-light-CN3xqimI.js";const re={class:"article-edit-page"},ie={class:"edit-container"},de={class:"page-header"},ce={class:"page-title"},ve={key:0,class:"cover-preview"},me={class:"tags-wrapper"},pe={class:"tags-container"},fe={class:"tag-suggestions"},ge={class:"editor-container"},_e=["innerHTML"],ye={class:"form-actions"},be={key:0,class:"form-error"},he={__name:"ArticleEdit",setup(we){const h=te(),w=oe(),k=ue(),N=le(),_=R(()=>!!h.params.id),M=R(()=>h.params.id),e=u({title:"",summary:"",content:"",tags:[],cover:""}),S=u(!1),V=u(!1),d=u(""),U=u(null),B=u(!1),x=u(!1),c=u(null),q=u(null);u("");const z=[{value:"技术",label:"技术"},{value:"前端",label:"前端"},{value:"Vue",label:"Vue"},{value:"React",label:"React"},{value:"后端",label:"后端"},{value:"数据库",label:"数据库"},{value:"设计",label:"设计"},{value:"产品",label:"产品"},{value:"职场",label:"职场"}];K.setOptions({highlight:function(t,l){return l&&T.getLanguage(l)?T.highlight(t,{language:l}).value:T.highlightAuto(t).value},breaks:!0}),ae(async()=>{if(!N.isLoggedIn){w.push({path:"/login",query:{redirect:h.fullPath}});return}_.value&&await D()});const D=async()=>{B.value=!0,c.value=null;try{const t=await k.fetchArticleById(M.value);t?(e.value.title=t.title,e.value.summary=t.summary,e.value.content=t.content,e.value.tags=t.tags||[],e.value.cover=t.cover):c.value="文章不存在或已被删除"}catch(t){console.error("获取文章详情失败:",t),c.value="获取文章详情失败"}finally{B.value=!1}},O=t=>K.parse(t||""),j=async()=>{x.value=!0;try{let t;_.value?t=await k.updateArticle(M.value,e.value):t=await k.createArticle(e.value),t&&w.push(`/article/${t.id}`)}catch(t){console.error("保存文章失败:",t),c.value="保存文章失败"}finally{x.value=!1}},C=()=>{d.value&&!e.value.tags.includes(d.value)&&e.value.tags.push(d.value),V.value=!1,d.value=""},J=()=>{V.value=!0,nextTick(()=>{var t;(t=U.value)==null||t.focus()})},P=t=>{e.value.tags=e.value.tags.filter(l=>l!==t)},G=t=>{t.key==="Enter"&&C()},Q=()=>e.value.title.trim()?e.value.content.trim()?null:"请输入文章内容":"请输入文章标题",I=R(()=>Q());return(t,l)=>{const W=i("el-alert"),p=i("el-input"),v=i("el-form-item"),y=i("el-button"),X=i("el-image"),E=i("el-tag"),Y=i("el-form");return r(),f("div",re,[c.value?(r(),b(W,{key:0,title:c.value,type:"error","show-icon":"",closable:"",class:"error-alert"},null,8,["title"])):A("",!0),n("div",ie,[n("div",de,[n("h1",ce,g(_.value?"编辑文章":"创建文章"),1)]),o(Y,{model:e.value,"label-position":"top"},{default:s(()=>[o(v,{label:"文章标题",required:""},{default:s(()=>[o(p,{modelValue:e.value.title,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.title=a),placeholder:"请输入文章标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(v,{label:"文章摘要"},{default:s(()=>[o(p,{modelValue:e.value.summary,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.summary=a),type:"textarea",rows:3,placeholder:"请输入文章摘要",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(v,{label:"封面图"},{default:s(()=>[o(p,{modelValue:e.value.cover,"onUpdate:modelValue":l[3]||(l[3]=a=>e.value.cover=a),placeholder:"请输入图片URL"},{append:s(()=>[o(y,{onClick:l[2]||(l[2]=a=>e.value.cover="")},{default:s(()=>l[7]||(l[7]=[m("清除")])),_:1})]),_:1},8,["modelValue"]),e.value.cover?(r(),f("div",ve,[o(X,{src:e.value.cover,fit:"cover"},{error:s(()=>l[8]||(l[8]=[n("div",{class:"image-placeholder"},"图片加载失败",-1)])),_:1},8,["src"])])):A("",!0)]),_:1}),o(v,{label:"文章标签"},{default:s(()=>[n("div",me,[n("div",pe,[(r(!0),f(L,null,F(e.value.tags,a=>(r(),b(E,{key:a,closable:"",onClose:Z=>P(a),class:"tag-item"},{default:s(()=>[m(g(a),1)]),_:2},1032,["onClose"]))),128)),V.value?(r(),b(p,{key:0,ref_key:"tagInputRef",ref:U,modelValue:d.value,"onUpdate:modelValue":l[4]||(l[4]=a=>d.value=a),class:"tag-input",size:"small",onKeyup:se(C,["enter"]),onBlur:C,onKeydown:G},null,8,["modelValue"])):(r(),b(y,{key:1,class:"button-new-tag",size:"small",onClick:J,disabled:e.value.tags.length>=5},{default:s(()=>l[9]||(l[9]=[m(" + 添加标签 ")])),_:1},8,["disabled"]))]),n("div",fe,[l[10]||(l[10]=n("span",null,"推荐标签: ",-1)),(r(),f(L,null,F(z,a=>o(E,{key:a.value,effect:"plain",size:"small",class:"suggestion-tag",onClick:Z=>e.value.tags.includes(a.value)?null:e.value.tags.push(a.value),disabled:e.value.tags.includes(a.value)},{default:s(()=>[m(g(a.label),1)]),_:2},1032,["onClick","disabled"])),64))])])]),_:1}),o(v,{label:"文章内容",required:""},{default:s(()=>[n("div",ge,[$(o(p,{modelValue:e.value.content,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.content=a),type:"textarea",rows:15,placeholder:"请输入文章内容 (支持Markdown格式)",ref_key:"editorRef",ref:q,class:"editor-textarea"},null,8,["modelValue"]),[[H,!S.value]]),$(n("div",{class:"preview-container markdown-body",innerHTML:O(e.value.content)},null,8,_e),[[H,S.value]])])]),_:1}),o(v,null,{default:s(()=>[n("div",ye,[o(y,{onClick:l[6]||(l[6]=a=>ne(w).go(-1))},{default:s(()=>l[11]||(l[11]=[m("取消")])),_:1}),o(y,{type:"primary",onClick:j,loading:x.value,disabled:!!I.value},{default:s(()=>[m(g(_.value?"更新文章":"发布文章"),1)]),_:1},8,["loading","disabled"])]),I.value?(r(),f("div",be,g(I.value),1)):A("",!0)]),_:1})]),_:1},8,["model"])])])}}},Ce=ee(he,[["__scopeId","data-v-bca9281c"]]);export{Ce as default};
