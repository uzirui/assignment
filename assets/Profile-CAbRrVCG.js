import{_ as G,p as H,j as z,r as m,o as J,d as K,c as u,f as x,m as L,e as d,a as t,w as i,b as o,t as c,u as O,F as Q,g as W,h as r,i as v}from"./index-CIru5doz.js";import{u as X}from"./article-V0l2JBZU.js";const Y={class:"profile-page"},Z={key:1,class:"profile-container"},ee={class:"user-info-section card"},te={class:"section-header"},ae={key:1,class:"edit-actions"},se={key:0,class:"view-profile"},le={class:"user-avatar"},oe={class:"user-details"},ie={class:"user-name"},re={class:"user-role"},ne={class:"user-email"},ue={class:"user-joined"},ce={key:0,class:"user-bio"},de={key:1,class:"user-bio"},ve={class:"form-layout"},me={class:"avatar-column"},_e={class:"avatar-preview"},pe={class:"details-column"},fe={class:"user-articles-section card"},ye={class:"section-header"},ge={key:0,class:"loading-container"},he={key:1,class:"empty-articles"},be={key:2,class:"articles-list"},ke=["onClick"],we={class:"article-title"},Ce={class:"article-summary"},Ve={class:"article-meta"},Ae={class:"publish-date"},xe={class:"article-actions"},Ue={__name:"Profile",setup(De){const f=K(),y=H(),k=X(),s=z(()=>y.user),l=m({username:"",email:"",bio:"",avatar:""}),w=m([]),C=m(!1),N={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应在3-20个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},V=m(null),_=m(!1),A=m(!1),g=m(null);J(async()=>{if(!y.isLoggedIn){f.push("/login");return}await y.fetchUserProfile(),U(),s.value&&(l.value.username=s.value.username||"",l.value.email=s.value.email||"",l.value.bio=s.value.bio||"",l.value.avatar=s.value.avatar||"")});const U=async()=>{C.value=!0;try{await k.fetchArticles({page:1,limit:6}),w.value=k.articles.slice(0,3)}catch(n){console.error("获取用户文章失败:",n)}finally{C.value=!1}},D=()=>{_.value&&s.value&&(l.value.username=s.value.username||"",l.value.email=s.value.email||"",l.value.bio=s.value.bio||"",l.value.avatar=s.value.avatar||""),_.value=!_.value},P=async()=>{V.value&&await V.value.validate(async n=>{if(n){A.value=!0,g.value=null;try{await y.updateProfile(l.value)&&(_.value=!1)}catch(e){console.error("更新个人资料失败:",e),g.value="更新个人资料失败"}finally{A.value=!1}}})},B=n=>{f.push(`/article/${n}`)},E=n=>{f.push(`/article/edit/${n}`)},R=async n=>{try{await k.deleteArticle(n)&&U()}catch(e){console.error("删除文章失败:",e)}},F=z(()=>!s.value||!s.value.createdAt?"":new Date(s.value.createdAt).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}));return(n,e)=>{const T=d("el-alert"),p=d("el-button"),S=d("el-avatar"),h=d("el-input"),b=d("el-form-item"),j=d("el-form"),q=d("el-skeleton"),I=d("el-empty"),M=d("el-popconfirm");return r(),u("div",Y,[g.value?(r(),x(T,{key:0,title:g.value,type:"error","show-icon":"",class:"profile-error"},null,8,["title"])):L("",!0),s.value?(r(),u("div",Z,[t("div",ee,[t("div",te,[e[8]||(e[8]=t("h2",{class:"section-title"},"个人资料",-1)),_.value?(r(),u("div",ae,[o(p,{onClick:D},{default:i(()=>e[6]||(e[6]=[v("取消")])),_:1}),o(p,{type:"primary",onClick:P,loading:A.value},{default:i(()=>e[7]||(e[7]=[v(" 保存 ")])),_:1},8,["loading"])])):(r(),x(p,{key:0,type:"primary",plain:"",onClick:D},{default:i(()=>e[5]||(e[5]=[v(" 编辑资料 ")])),_:1}))]),_.value?(r(),x(j,{key:1,ref_key:"formRef",ref:V,model:l.value,rules:N,"label-position":"top",class:"edit-profile"},{default:i(()=>[t("div",ve,[t("div",me,[o(b,{label:"头像"},{default:i(()=>[t("div",_e,[o(S,{size:100,src:l.value.avatar},{default:i(()=>{var a;return[v(c((a=l.value.username)==null?void 0:a.charAt(0).toUpperCase()),1)]}),_:1},8,["src"])]),o(h,{modelValue:l.value.avatar,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.avatar=a),placeholder:"请输入头像URL",class:"avatar-input"},null,8,["modelValue"])]),_:1})]),t("div",pe,[o(b,{label:"用户名",prop:"username"},{default:i(()=>[o(h,{modelValue:l.value.username,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.username=a)},null,8,["modelValue"])]),_:1}),o(b,{label:"邮箱",prop:"email"},{default:i(()=>[o(h,{modelValue:l.value.email,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.email=a)},null,8,["modelValue"])]),_:1}),o(b,{label:"个人简介"},{default:i(()=>[o(h,{modelValue:l.value.bio,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.bio=a),type:"textarea",rows:3,placeholder:"介绍一下自己吧...",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})])])]),_:1},8,["model"])):(r(),u("div",se,[t("div",le,[o(S,{size:100,src:s.value.avatar},{default:i(()=>{var a;return[v(c((a=s.value.username)==null?void 0:a.charAt(0).toUpperCase()),1)]}),_:1},8,["src"])]),t("div",oe,[t("div",ie,c(s.value.username),1),t("div",re,c(s.value.role==="admin"?"管理员":"普通用户"),1),t("div",ne,c(s.value.email),1),t("div",ue,"注册于: "+c(F.value),1),s.value.bio?(r(),u("div",ce,c(s.value.bio),1)):(r(),u("div",de,"这个人很懒，什么都没留下~"))])]))]),t("div",fe,[t("div",ye,[e[10]||(e[10]=t("h2",{class:"section-title"},"我的文章",-1)),o(p,{type:"primary",onClick:e[4]||(e[4]=a=>O(f).push("/article/edit"))},{default:i(()=>e[9]||(e[9]=[v(" 写文章 ")])),_:1})]),C.value?(r(),u("div",ge,[o(q,{rows:3,animated:""})])):w.value.length===0?(r(),u("div",he,[o(I,{description:"您还没有发布过文章"})])):(r(),u("div",be,[(r(!0),u(Q,null,W(w.value,a=>(r(),u("div",{key:a.id,class:"article-item"},[t("div",{class:"article-content",onClick:$=>B(a.id)},[t("h3",we,c(a.title),1),t("p",Ce,c(a.summary),1),t("div",Ve,[t("span",Ae,c(new Date(a.createdAt).toLocaleDateString()),1),e[11]||(e[11]=t("div",{class:"article-stats"},null,-1))])],8,ke),t("div",xe,[o(p,{type:"primary",plain:"",size:"small",onClick:$=>E(a.id)},{default:i(()=>e[12]||(e[12]=[v(" 编辑 ")])),_:2},1032,["onClick"]),o(M,{title:"确定要删除这篇文章吗？","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:$=>R(a.id)},{reference:i(()=>[o(p,{type:"danger",plain:"",size:"small"},{default:i(()=>e[13]||(e[13]=[v(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"])])]))),128))]))])])):L("",!0)])}}},ze=G(Ue,[["__scopeId","data-v-5d7fe5e0"]]);export{ze as default};
