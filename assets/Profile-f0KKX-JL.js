import{_ as O,p as Q,j as z,r as v,o as W,d as X,c as d,f as U,m as L,e as r,a as t,w as i,b as a,t as u,u as Y,F as Z,g as ee,h as n,i as m}from"./index-j3DZukop.js";import{u as te}from"./article-CBd4WTgj.js";const se={class:"profile-page"},ae={key:1,class:"profile-container"},le={class:"user-info-section card"},oe={class:"section-header"},ie={key:1,class:"edit-actions"},ne={key:0,class:"view-profile"},re={class:"user-avatar"},ue={class:"user-details"},ce={class:"user-name"},de={class:"user-role"},me={class:"user-email"},ve={class:"user-joined"},_e={key:0,class:"user-bio"},pe={key:1,class:"user-bio"},fe={class:"form-layout"},ye={class:"avatar-column"},he={class:"avatar-preview"},ge={class:"details-column"},be={class:"user-articles-section card"},ke={class:"section-header"},Ce={key:0,class:"loading-container"},we={key:1,class:"empty-articles"},Ve={key:2,class:"articles-list"},Ae=["onClick"],xe={class:"article-title"},Ue={class:"article-summary"},De={class:"article-meta"},Se={class:"publish-date"},Re={class:"article-stats"},$e={class:"stat-item"},ze={class:"stat-item"},Le={class:"stat-item"},Ne={class:"article-actions"},Pe={__name:"Profile",setup(Be){const f=X(),y=Q(),k=te(),l=z(()=>y.user),o=v({username:"",email:"",bio:"",avatar:""}),C=v([]),w=v(!1),N={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应在3-20个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},V=v(null),_=v(!1),A=v(!1),h=v(null);W(async()=>{if(!y.isLoggedIn){f.push("/login");return}await y.fetchUserProfile(),D(),l.value&&(o.value.username=l.value.username||"",o.value.email=l.value.email||"",o.value.bio=l.value.bio||"",o.value.avatar=l.value.avatar||"")});const D=async()=>{w.value=!0;try{await k.fetchArticles({page:1,limit:6}),C.value=k.articles.slice(0,3)}catch(c){console.error("获取用户文章失败:",c)}finally{w.value=!1}},S=()=>{_.value&&l.value&&(o.value.username=l.value.username||"",o.value.email=l.value.email||"",o.value.bio=l.value.bio||"",o.value.avatar=l.value.avatar||""),_.value=!_.value},P=async()=>{V.value&&await V.value.validate(async c=>{if(c){A.value=!0,h.value=null;try{await y.updateProfile(o.value)&&(_.value=!1)}catch(e){console.error("更新个人资料失败:",e),h.value="更新个人资料失败"}finally{A.value=!1}}})},B=c=>{f.push(`/article/${c}`)},E=c=>{f.push(`/article/edit/${c}`)},F=async c=>{try{await k.deleteArticle(c)&&D()}catch(e){console.error("删除文章失败:",e)}},T=z(()=>!l.value||!l.value.createdAt?"":new Date(l.value.createdAt).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}));return(c,e)=>{const j=r("el-alert"),p=r("el-button"),R=r("el-avatar"),g=r("el-input"),b=r("el-form-item"),q=r("el-form"),I=r("el-skeleton"),M=r("el-empty"),G=r("View"),x=r("el-icon"),H=r("ChatDotRound"),J=r("Star"),K=r("el-popconfirm");return n(),d("div",se,[h.value?(n(),U(j,{key:0,title:h.value,type:"error","show-icon":"",class:"profile-error"},null,8,["title"])):L("",!0),l.value?(n(),d("div",ae,[t("div",le,[t("div",oe,[e[8]||(e[8]=t("h2",{class:"section-title"},"个人资料",-1)),_.value?(n(),d("div",ie,[a(p,{onClick:S},{default:i(()=>e[6]||(e[6]=[m("取消")])),_:1}),a(p,{type:"primary",onClick:P,loading:A.value},{default:i(()=>e[7]||(e[7]=[m(" 保存 ")])),_:1},8,["loading"])])):(n(),U(p,{key:0,type:"primary",plain:"",onClick:S},{default:i(()=>e[5]||(e[5]=[m(" 编辑资料 ")])),_:1}))]),_.value?(n(),U(q,{key:1,ref_key:"formRef",ref:V,model:o.value,rules:N,"label-position":"top",class:"edit-profile"},{default:i(()=>[t("div",fe,[t("div",ye,[a(b,{label:"头像"},{default:i(()=>[t("div",he,[a(R,{size:100,src:o.value.avatar},{default:i(()=>{var s;return[m(u((s=o.value.username)==null?void 0:s.charAt(0).toUpperCase()),1)]}),_:1},8,["src"])]),a(g,{modelValue:o.value.avatar,"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.avatar=s),placeholder:"请输入头像URL",class:"avatar-input"},null,8,["modelValue"])]),_:1})]),t("div",ge,[a(b,{label:"用户名",prop:"username"},{default:i(()=>[a(g,{modelValue:o.value.username,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.username=s)},null,8,["modelValue"])]),_:1}),a(b,{label:"邮箱",prop:"email"},{default:i(()=>[a(g,{modelValue:o.value.email,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.email=s)},null,8,["modelValue"])]),_:1}),a(b,{label:"个人简介"},{default:i(()=>[a(g,{modelValue:o.value.bio,"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.bio=s),type:"textarea",rows:3,placeholder:"介绍一下自己吧...",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})])])]),_:1},8,["model"])):(n(),d("div",ne,[t("div",re,[a(R,{size:100,src:l.value.avatar},{default:i(()=>{var s;return[m(u((s=l.value.username)==null?void 0:s.charAt(0).toUpperCase()),1)]}),_:1},8,["src"])]),t("div",ue,[t("div",ce,u(l.value.username),1),t("div",de,u(l.value.role==="admin"?"管理员":"普通用户"),1),t("div",me,u(l.value.email),1),t("div",ve,"注册于: "+u(T.value),1),l.value.bio?(n(),d("div",_e,u(l.value.bio),1)):(n(),d("div",pe,"这个人很懒，什么都没留下~"))])]))]),t("div",be,[t("div",ke,[e[10]||(e[10]=t("h2",{class:"section-title"},"我的文章",-1)),a(p,{type:"primary",onClick:e[4]||(e[4]=s=>Y(f).push("/article/edit"))},{default:i(()=>e[9]||(e[9]=[m(" 写文章 ")])),_:1})]),w.value?(n(),d("div",Ce,[a(I,{rows:3,animated:""})])):C.value.length===0?(n(),d("div",we,[a(M,{description:"您还没有发布过文章"})])):(n(),d("div",Ve,[(n(!0),d(Z,null,ee(C.value,s=>(n(),d("div",{key:s.id,class:"article-item"},[t("div",{class:"article-content",onClick:$=>B(s.id)},[t("h3",xe,u(s.title),1),t("p",Ue,u(s.summary),1),t("div",De,[t("span",Se,u(new Date(s.createdAt).toLocaleDateString()),1),t("div",Re,[t("span",$e,[a(x,null,{default:i(()=>[a(G)]),_:1}),m(" "+u(s.viewCount),1)]),t("span",ze,[a(x,null,{default:i(()=>[a(H)]),_:1}),m(" "+u(s.commentCount),1)]),t("span",Le,[a(x,null,{default:i(()=>[a(J)]),_:1}),m(" "+u(s.likeCount),1)])])])],8,Ae),t("div",Ne,[a(p,{type:"primary",plain:"",size:"small",onClick:$=>E(s.id)},{default:i(()=>e[11]||(e[11]=[m(" 编辑 ")])),_:2},1032,["onClick"]),a(K,{title:"确定要删除这篇文章吗？","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:$=>F(s.id)},{reference:i(()=>[a(p,{type:"danger",plain:"",size:"small"},{default:i(()=>e[12]||(e[12]=[m(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"])])]))),128))]))])])):L("",!0)])}}},Te=O(Pe,[["__scopeId","data-v-22637d6d"]]);export{Te as default};
